{"version":3,"sources":["../../src/HeatMap/generate.js"],"names":["iconSize","prefixSIFormat","d3","format","searchValIndex","val","arr","n1","n2","length","c","binSize","n","test","a","b","v","Math","floor","window","console","log","min","max","computeFactor","val0","val1","bin0","bin1","factor","getInterpFactor","pixel","valPixs","index0","index1","matrixAverage","xFactor","val00","val01","yFactor","val10","val11","undefined","dx","dy","dxy","valueForPixel","value","reverse","len","minVal","maxVal","i","round","matrixInterp","w","h","d","x","y","z","x0","y0","x1","y1","cw","ch","xValPixs","yValPixs","pixels","index","Uint8Array","e","Array","xInterpArray","j","yInterp","yInvalidIndex","invalid","yInvalid","findIndex","o","rgba","r","g","opacity","xInterp","xInvalidIndex","xInvalid","drawend","zContext","xScale","yScale","save","clearRect","width$","height$","showHeat$","zScale","zScale$","viewRange","data","heat","xMinPx","xMaxPx","yMinPx","yMaxPx","width","height","xcMinPx","xcMaxPx","ycMinPx","ycMaxPx","xMin","xMax","yMin","yMax","dataRange","cWidth","cHeight","pixelData","color","imageData","createImageData","set","cdata","putImageData","canvas","tempCanvas$","getContext","range","map","invert","restore","drawing","lineMarkX","lineMark$","node","xp","datum","scale","style","lineMarkY","yp","drawImage","tipCompute","prevRes","point","scaleAxis","scaleOpt","tooltip","cross","average","getPointData","newPoint","prevValue","slice","ndata","k","result","selection","selectAll","join","attr","html","label","unit","updateScale","zFormat","domain","copy","clamp","legend","linearGradient","rootSelection$","select","heatLegend","startDomain","deltDomain","_","enter","tick","append","text","update","doubleClick","heatData","xval","yval","setLineMark","res","generateHeatMap","superName","HeatMap","restOptions","restData","rWidth","show","left","util","isNumber","right","compute","args","call","tempText","subLabel","baselineDelt","fontSize","heatLabel","padding","measureSvgText","split","forEach","key","zoomSelection$","lineMark","zCanvasParent","insert","zCanvas","gradientId","guid","scaleLinear","document","createElement","dblclick$$","dblclick$","x2","y2","sourceEvent","pointer","click$$","click$","lm","contextmenu$$","contextmenu$","zooming$$","zooming$","zoomend$$","zoomend$","debounceDrawend$","debounce","leading","trailing","type","delay","flush","resize$$","resize$","rest","ticks","on","destroyed","rendered","render","avg","currentPoint","touches","changedTouches","zval","findNearIndex","xi0","xi1","yi0","yi1","xval0","xval1","yval0","yval1","xi","abs","yi","push","cb","xSelect","ySelect","xBin","vv","yBin","v0","v1","computeDomain","needDomain","domains","extent","svgDiv","parseInt","top","image","cancel","zoomstart$","reset$","canZoom$","BaseChart","mixin","replace","LineGraph"],"mappings":"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","sourcesContent":["// @ts-nocheck\n/*\n * @Author: Huangjs\n * @Date: 2021-12-07 15:02:48\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-03-27 14:01:00\n * @Description: 按需生成HeatMap构造器\n */\n\nimport * as d3 from 'd3';\nimport BaseChart from '../BaseChart';\nimport LineGraph from '../LineGraph';\nimport * as util from '../util';\nimport mixin from '../util/mixin';\n\nconst iconSize = 18;\n\nconst prefixSIFormat = d3.format('~s');\n\nconst searchValIndex = (val, arr) => {\n  let n1 = 0;\n  let n2 = arr.length;\n  let c = 0;\n  const binSize = n2 > 1 ? (arr[n2 - 1] - arr[0]) / (n2 - 1) : 1;\n  let n;\n  let test;\n  if (binSize >= 0) {\n    test = (a, b) => a <= b;\n  } else {\n    test = (a, b) => a > b;\n  }\n  // don't trust floating point equality - fraction of bin size to call\n  const v = val + binSize * 1e-9 * (binSize >= 0 ? 1 : -1);\n  // c is just to avoid infinite loops if there's an error\n  while (n1 < n2 && c < 100) {\n    c += 1;\n    n = Math.floor((n1 + n2) / 2);\n    if (test(arr[n], v)) n1 = n + 1;\n    else n2 = n;\n  }\n  if (c > 90) window.console.log('Long binary search...');\n  return Math.min(Math.max(n1 - 1, 0), arr.length - 1);\n};\n// 计算两值之间任意值占比以及前后值\nconst computeFactor = (val, val0, val1, bin0, bin1) => {\n  const factor = (val - val0) / (val1 - val0) || 0;\n  if (factor <= 0) {\n    return {\n      factor: 0,\n      bin0,\n      bin1: bin0,\n    };\n  }\n  if (factor > 0.5) {\n    return {\n      factor: 1 - factor,\n      bin0: bin1,\n      bin1: bin0,\n    };\n  }\n  return {\n    factor,\n    bin0,\n    bin1,\n  };\n};\n// 计算每个像素对应值的插值计算比例\nconst getInterpFactor = (pixel, valPixs) => {\n  const index0 = searchValIndex(pixel, valPixs);\n  const index1 = index0 + 1;\n  return computeFactor(pixel, valPixs[index0], valPixs[index1], index0, index1);\n};\n// 根据四个点计算中间点的平均值\nconst matrixAverage = (xFactor, val00, val01, yFactor, val10, val11) => {\n  let val = 0;\n  if (val00 !== undefined) {\n    const dx = val01 - val00 || 0;\n    const dy = val10 - val00 || 0;\n    let dxy = 0;\n    if (val01 === undefined) {\n      if (val11 === undefined) dxy = 0;\n      else if (val10 === undefined) dxy = 2 * (val11 - val00);\n      else dxy = ((2 * val11 - val10 - val00) * 2) / 3;\n    } else if (val11 === undefined) {\n      if (val10 === undefined) dxy = 0;\n      else dxy = ((2 * val00 - val01 - val10) * 2) / 3;\n    } else if (val10 === undefined) dxy = ((2 * val11 - val01 - val00) * 2) / 3;\n    else dxy = val11 + val00 - val01 - val10;\n    val = val00 + (xFactor || 0) * dx + (yFactor || 0) * (dy + (xFactor || 0) * dxy);\n  }\n  return val;\n};\n// 将给定值数组中的值映射到给定长度的每一个像素点上\n// 若值数组长度比像素点多，则会均匀抽稀映射\n// 若值数组长度比像素点少，则会平滑插值映射\nconst valueForPixel = (value, pixel, reverse) => {\n  const valPixs = [];\n  const len = value.length;\n  const minVal = value[0];\n  const maxVal = value[len - 1];\n  for (let i = 0; i < len; i += 1) {\n    valPixs[reverse ? len - 1 - i : i] = Math.round(\n      Math.round(100 * pixel * ((value[i] - minVal) / (maxVal - minVal))) / 100\n    );\n  }\n  return valPixs;\n};\n// 矩阵插值上色（根据矩形四个点值，计算矩形内部所有像素点的值，并渲染颜色）\nconst matrixInterp = ({ w, h, d }, { x, y, z }, c) => {\n  const [[x0, y0], [x1, y1]] = d;\n  const cw = x1 - x0;\n  const ch = y1 - y0;\n  const xValPixs = valueForPixel(x, w);\n  const yValPixs = valueForPixel(y, h, true);\n  let pixels;\n  let index = 0;\n  try {\n    pixels = new Uint8Array(cw * ch * 4);\n  } catch (e) {\n    pixels = new Array(cw * ch * 4);\n  }\n  const xInterpArray = [];\n  for (let j = y0; j < y1; j += 1) {\n    const yInterp = getInterpFactor(j, yValPixs);\n    const val0 = z[yInterp.bin0] || [];\n    const val1 = z[yInterp.bin1] || [];\n    // 获取y轴(横向)范围内无效索引集合\n    const yInvalidIndex = y.invalid || [];\n    // 判断当前横向一整条像素的上bin0下bin1都是无效索引，则无效\n    const yInvalid = yInvalidIndex.findIndex((o) => o === yInterp.bin0 || o === yInterp.bin1) !== -1;\n    for (let i = x0; i < x1; i += 1) {\n      let rgba = { r: 0, g: 0, b: 0, opacity: 0 };\n      // 有效才计算颜色\n      if (!yInvalid) {\n        let xInterp = xInterpArray[i];\n        if (!xInterp) {\n          xInterp = getInterpFactor(i, xValPixs);\n          xInterpArray[i] = xInterp;\n        }\n        // 获取x轴(竖向)范围内无效索引集合\n        const xInvalidIndex = x.invalid || [];\n        // 判断当前像素点的左bin0右bin1都是无效索引，则无效\n        const xInvalid = xInvalidIndex.findIndex((o) => o === xInterp.bin0 || o === xInterp.bin1) !== -1;\n        // 有效才计算颜色\n        if (!xInvalid) {\n          rgba = c(\n            matrixAverage(\n              xInterp.factor,\n              val0[xInterp.bin0],\n              val0[xInterp.bin1],\n              yInterp.factor,\n              val1[xInterp.bin0],\n              val1[xInterp.bin1]\n            )\n          );\n        }\n      }\n      pixels[index] = rgba.r;\n      pixels[index + 1] = rgba.g;\n      pixels[index + 2] = rgba.b;\n      pixels[index + 3] = rgba.opacity * 255; // 透明度0-1需要转换成0-255\n      index += 4;\n    }\n  }\n  return pixels;\n};\n\nfunction drawend(zContext, { xScale, yScale }) {\n  zContext.save();\n  // 先清空画布\n  zContext.clearRect(0, 0, this.width$, this.height$);\n  if (this.showHeat$) {\n    const zScale = this.zScale$;\n    let viewRange = null;\n    const { x, y, z } = this.data.heat;\n    // 原始范围\n    // 根据xy轴的刻度变换函数分别计算出原始数据图的上下左右坐标位置\n    const xMinPx = xScale(x[0] || 0);\n    const xMaxPx = xScale(x[x.length - 1] || 0);\n    // 因为y坐标是反转的（domain和range大小反转对应）\n    const yMinPx = yScale(y[y.length - 1] || 0);\n    const yMaxPx = yScale(y[0] || 0);\n    // 原始数据的实际宽高\n    const width = Math.round(xMaxPx - xMinPx);\n    const height = Math.round(yMaxPx - yMinPx);\n    // 如果实际的宽高小于或等于0则表示压根没有数据\n    if (width > 0 && height > 0) {\n      // 画布范围\n      // 画布上下左右坐标位置，this.width$, this.height$是画布的宽高\n      const xcMinPx = 0;\n      const xcMaxPx = this.width$ + xcMinPx;\n      const ycMinPx = 0;\n      const ycMaxPx = this.height$ + ycMinPx;\n      // 真实渲染的数据，是原始数据的范围，配置中筛选的范围以及画布的范围最终确定\n      // 根据以上三个范围计算确定真正需要渲染的范围，要考虑此范围的两个问题：\n      // 1，对于原始数据段转换的像素范围，应该选择哪一段像素去渲染？\n      // 2，对于视图，这一段数据应该渲染在画布上哪一个范围（在画布内部的位置）？\n      // 以下计算需要渲染的像素段在原始数据像素范围内（宽和高）起点和终点的索引\n      const xMin = Math.max(xcMinPx, xMinPx); // 取x最小范围中的最大值\n      const xMax = Math.min(xcMaxPx, xMaxPx); // 取x最大范围中的最小值\n      const yMin = Math.max(ycMinPx, yMinPx); // 取y最小范围中的最大值\n      const yMax = Math.min(ycMaxPx, yMaxPx); // 取y最大范围中的最小值\n      // 实际被裁减后的宽高（可能等于画布宽高，也可能小于，但是不会大于因为被裁掉了）\n      const dataRange = [\n        [Math.round(xMin - xMinPx), Math.round(yMin - yMinPx)], // 筛选后数据在原数据的起点index\n        [Math.round(xMax - xMinPx), Math.round(yMax - yMinPx)], // 筛选后数据在原数据的终点index\n      ];\n      const cWidth = dataRange[1][0] - dataRange[0][0];\n      const cHeight = dataRange[1][1] - dataRange[0][1];\n      // 如果裁剪后的宽高小于或等于0则表示没有可以渲染的数据了\n      if (cWidth > 0 && cHeight > 0) {\n        // 计算出渲染图片的每个像素rgba值\n        const pixelData = matrixInterp(\n          {\n            w: width,\n            h: height,\n            d: dataRange,\n          },\n          { x, y, z },\n          (v) => {\n            // 老版本d3得到的rgba是字符串，新版本d3是对象，这里做个兼容\n            const rgba = zScale(v);\n            return typeof rgba === 'string' ? d3.color(rgba) : rgba;\n          }\n        );\n        // 创建一个空的图片数据（使用裁剪后的宽高）\n        const imageData = zContext.createImageData(cWidth, cHeight);\n        // 将像素数据设置到图片数据内\n        try {\n          imageData.data.set(pixelData);\n        } catch (e) {\n          const cdata = imageData.data;\n          const len = cdata.length;\n          for (let i = 0; i < len; i += 1) {\n            cdata[i] = pixelData[i];\n          }\n        }\n        // 以下计在算在画布上需要渲染的范围起点和终点的位置（相对于画布）\n        viewRange = [\n          [xMin - xcMinPx, yMin - ycMinPx],\n          [xMax - xcMinPx, yMax - ycMinPx],\n        ];\n        // 将计算好的数据放到画布\n        zContext.putImageData(imageData, Math.round(viewRange[0][0]), Math.round(viewRange[0][1]));\n        const { canvas } = this.tempCanvas$;\n        if (canvas) {\n          // 存储渲染后的裁剪数据和图片数据\n          canvas.width = cWidth;\n          canvas.height = cHeight;\n          canvas.getContext('2d').putImageData(imageData, 0, 0);\n        }\n      }\n    }\n    this.tempCanvas$.range = !viewRange\n      ? null\n      : viewRange.map((r) => r.map((v, i) => (i === 0 ? xScale : yScale).invert(v)));\n  }\n  zContext.restore();\n}\n\nfunction drawing(zContext, { xScale, yScale }) {\n  if (this.showHeat$) {\n    const lineMarkX = this.lineMark$[0];\n    if (lineMarkX.node()) {\n      const xp = xScale(lineMarkX.datum()) || (!this.scale.x ? this.width$ : 0);\n      lineMarkX.style('left', `${xp}px`).style('display', xp < 0 || xp >= this.width$ ? 'none' : 'block');\n    }\n    const lineMarkY = this.lineMark$[1];\n    if (lineMarkY.node()) {\n      const yp = yScale(lineMarkY.datum()) || (!this.scale.y ? 0 : this.height$);\n      lineMarkY.style('top', `${yp}px`).style('display', yp < 0 || yp >= this.height$ ? 'none' : 'block');\n    }\n    const { canvas, range } = this.tempCanvas$;\n    if (range) {\n      // 将上一次变换后的图，经过本次变换的变形重新绘制到画布上\n      const [[x0, y0], [x1, y1]] = range.map((r) => r.map((v, i) => (i === 0 ? xScale : yScale)(v)));\n      zContext.save();\n      zContext.clearRect(0, 0, this.width$, this.height$);\n      zContext.drawImage(canvas, x0, y0, x1 - x0, y1 - y0);\n      zContext.restore();\n    }\n  }\n}\n\nfunction tipCompute(prevRes, point, scaleAxis) {\n  const scaleOpt = this.scale;\n  const { cross, average } = this.tooltip;\n  const { point: newPoint, value } =\n    cross === 'xy' ? this.getPointData({ point, scaleAxis }, average) : { point, value: [] };\n  if (value.length > 0) {\n    // 去掉第一个因为第一个是标题\n    const prevValue = (prevRes.data || []).slice(1);\n    const ndata = [\n      ...value.map((v, i) => {\n        const k = i === 0 ? 'x' : i === 1 ? 'y' : 'z';\n        return {\n          ...scaleOpt[scaleAxis[k] ? k : `${k}${k != 'z' ? '2' : ''}`],\n          value: v,\n        };\n      }),\n      ...prevValue,\n    ];\n    const result = (selection) => {\n      selection\n        .selectAll('div')\n        .data(ndata)\n        .join('div')\n        .attr('style', 'white-space: nowrap;')\n        .html((d, i) =>\n          i === 0\n            ? `${d.label ? `${d.label}: ` : ''}${d.format(d.value)}${d.unit || ''}`\n            : `${\n                !d.color\n                  ? ''\n                  : `<span style=\"background: ${d.color}; width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 8px;\"></span>`\n              }<span>${d.label ? `${d.label}: ` : ''}</span><span style=\"display: inline-block; ${\n                !d.color ? '' : 'margin-left: 30px;'\n              }\">${d.format(d.value)}${d.unit || ''}</span>`\n        );\n    };\n    return { x0: newPoint[0], y0: newPoint[1], data: ndata, result };\n  }\n  return { ...prevRes };\n}\n\nfunction updateScale() {\n  if (this.scale.z) {\n    const zFormat = this.scale.z.format || ((v) => v);\n    let [opacity, range, domain] = this.scale.z.domain || [];\n    opacity = opacity || 1;\n    range = range || ['#000', '#fff'];\n    domain = domain || [0, 1];\n    this.zScale$\n      .range(range.map((c) => d3.color(c).copy({ opacity })))\n      .domain(domain)\n      .clamp(true); // 设置true可以卡住所给不在domain中的参数生成的数据仍然在range范围内\n    if (this.legend) {\n      const linearGradient = this.rootSelection$.select('linearGradient');\n      const heatLegend = this.rootSelection$.select('.heatLegend');\n      const height = this.height$;\n      const startDomain = domain[0];\n      const deltDomain = domain[domain.length - 1] - startDomain;\n      const width = this.legend.width;\n      linearGradient\n        .selectAll('stop')\n        .data(domain)\n        .join('stop')\n        .attr('offset', (v) => `${(100 * (v - startDomain)) / deltDomain}%`)\n        .attr('stop-color', (_, i) => range[i]);\n      heatLegend\n        .selectAll('g')\n        .data(domain)\n        .join(\n          (enter) => {\n            const tick = enter\n              .append('g')\n              .attr('class', 'tick')\n              .attr('transform', (v) => `translate(${width},${height * (1 - (v - startDomain) / deltDomain)})`);\n            tick.append('path').attr('d', 'M0,0 L4,4 L4,-4 Z');\n            tick\n              .append('text')\n              .attr('x', 8)\n              .attr('dy', '0.32em')\n              .attr('text-anchor', 'start')\n              .text((v) => zFormat(v));\n            return tick;\n          },\n          (update) => {\n            update.attr('transform', (v) => `translate(${width},${height * (1 - (v - startDomain) / deltDomain)})`);\n            update.select('text').text((v) => zFormat(v));\n            return update;\n          }\n        );\n    }\n  }\n}\n\nfunction doubleClick(point, { xScale, yScale }) {\n  let result = {};\n  if (this.showHeat$) {\n    const heatData = this.data.heat;\n    let [x0, y0] = point;\n    let [xval, yval] = [];\n    const lineMarkX = this.lineMark$[0];\n    if (lineMarkX.node()) {\n      xval = Math.max(Math.min(+xScale.invert(x0), heatData.x[heatData.x.length - 1]), heatData.x[0]);\n      x0 = xScale(xval);\n      lineMarkX.style('left', `${x0}px`).style('display', 'block');\n    }\n    const lineMarkY = this.lineMark$[1];\n    if (lineMarkY.node()) {\n      yval = Math.max(Math.min(+yScale.invert(y0), heatData.y[heatData.y.length - 1]), heatData.y[0]);\n      y0 = yScale(yval);\n      lineMarkY.style('top', `${y0}px`).style('display', 'block');\n    }\n    this.setLineMark([xval, yval], (res) => {\n      result = res;\n    });\n  }\n  return result;\n}\n\nexport default function generateHeatMap(superName) {\n  class HeatMap extends BaseChart {\n    constructor(...params) {\n      const { data, tooltip, legend, scale, ...restOptions } = params[0] || {};\n      const { heat, ...restData } = data || {};\n      let rWidth = restOptions.rWidth;\n      if (legend) {\n        legend.show = !!legend.show;\n        legend.left = util.isNumber(legend.left) ? legend.left : 0;\n        legend.width = util.isNumber(legend.width) ? legend.width : 0;\n        legend.right = util.isNumber(legend.right) ? legend.right : 0;\n        if (legend.show) {\n          rWidth = (util.isNumber(rWidth) ? rWidth : 0) + legend.left + legend.width + legend.right;\n        }\n      }\n      super({\n        ...restOptions,\n        rWidth,\n        data: {\n          heat: !heat ? { x: [], y: [], z: [] } : { x: heat.x || [], y: heat.y || [], z: heat.z || [] },\n          ...restData,\n        },\n        tooltip: !tooltip\n          ? false\n          : {\n              cross: 'xy',\n              select: '',\n              average: true,\n              ...tooltip,\n              compute: (res, ...args) => {\n                let result = tipCompute.call(this, res, ...args);\n                if (typeof tooltip.compute === 'function') {\n                  result = tooltip.compute.call(this, result, ...args);\n                }\n                return result;\n              },\n            },\n        scale: {\n          /* z: {\n            type: 'linear', // 坐标类型\n            ticks: 5, // 坐标刻度数目\n            format: (v) => v, // 坐标值格式化函数\n            domain: [0, ['#fff', '#fff'], [0, 0]], // 值的色域范围和透明度\n            label: '', // 坐标名称\n            unit: '', // 坐标值单位\n          }, */\n          z: { format: prefixSIFormat },\n          ...scale,\n        },\n      });\n      this.legend = legend;\n      this.showHeat$ = true;\n      const tempText = `${this.scale.z.label || ''}${this.scale.z.subLabel ? ` ( ${this.scale.z.subLabel} )` : ''}${\n        this.scale.z.unit ? ` ( ${this.scale.z.unit} )` : ''\n      }`;\n      const baselineDelt = this.fontSize + 2;\n      const heatLabel = this.rootSelection$\n        .select('g.group')\n        .append('g')\n        .attr('class', 'heatLabel')\n        .attr('fill', 'currentColor')\n        .attr(\n          'transform',\n          `translate(${this.scale.y ? 10 : this.width$ - 10},${\n            this.scale.x ? baselineDelt - this.padding[0] : this.height$ + this.padding[2] - iconSize + baselineDelt\n          })`\n        );\n      heatLabel\n        .append('text')\n        .attr('dx', ((this.scale.y ? 1 : -1) * util.measureSvgText(tempText, this.fontSize)) / 2)\n        .text(tempText);\n      if (this.tooltip) {\n        const { select } = this.tooltip;\n        (select || '').split('').forEach((key) => {\n          if (key) {\n            this.zoomSelection$\n              .append('div')\n              .attr('class', `${key}-linemark`)\n              .style('background', '#fa9305')\n              .style('display', 'none')\n              .style('position', 'absolute')\n              .style('top', !this.scale.y ? 0 : this.height$ - 1)\n              .style('left', !this.scale.x ? this.width$ - 1 : 0)\n              .style('width', key === 'x' ? '1px' : '100%')\n              .style('height', key === 'x' ? '100%' : '1px');\n          }\n        });\n      }\n      const lineMark = [this.zoomSelection$.select('.x-linemark'), this.zoomSelection$.select('.y-linemark')];\n      this.lineMark$ = lineMark;\n      const zCanvasParent = this.rootSelection$\n        .insert('div', 'svg')\n        .style('position', 'absolute')\n        .style('width', `${this.width$}px`)\n        .style('height', `${this.height$}px`)\n        .style('top', `${this.padding[0]}px`)\n        .style('left', `${this.padding[3]}px`);\n      const zCanvas = zCanvasParent\n        .append('canvas')\n        .style('width', '100%')\n        .style('height', '100%')\n        .attr('width', this.width$)\n        .attr('height', this.height$);\n      if (legend) {\n        const gradientId = util.guid('gradient');\n        this.rootSelection$\n          .select('svg')\n          .select('defs')\n          .append('linearGradient')\n          .attr('id', gradientId)\n          .attr('x1', '0%')\n          .attr('y1', '100%')\n          .attr('x2', '0%')\n          .attr('y2', '0%');\n        this.rootSelection$\n          .select('svg')\n          .select('.group')\n          .append('g')\n          .attr('class', 'heatLegend')\n          .style('display', legend.show ? 'block' : 'none')\n          .attr('fill', 'currentColor')\n          .attr('transform', `translate(${this.width$ + this.padding[1] + legend.left},0)`)\n          .append('rect')\n          .attr('x', 0)\n          .attr('y', 0)\n          .attr('width', legend.width)\n          .attr('height', this.height$)\n          .attr('fill', `url(#${gradientId})`);\n      }\n      const zContext = zCanvas.node().getContext('2d');\n      this.zScale$ = d3.scaleLinear();\n      updateScale.call(this);\n      this.tempCanvas$ = {\n        canvas: document.createElement('canvas'),\n        range: null,\n      };\n      const dblclick$$ = this.dblclick$;\n      this.dblclick$ = (e, ...args) => {\n        dblclick$$.call(null, e, ...args);\n        const { x, x2, y, y2 } = e.scaleAxis;\n        const xScale = (x || x2).scale;\n        const yScale = (y || y2).scale;\n        return doubleClick.call(this, e.sourceEvent ? d3.pointer(e.sourceEvent) : [0, 0], { xScale, yScale });\n      };\n      const click$$ = this.click$;\n      this.click$ = (e, ...args) => {\n        click$$.call(null, e, ...args);\n        lineMark.forEach((lm) => lm.node() && lm.style('display', 'none'));\n      };\n      const contextmenu$$ = this.contextmenu$;\n      this.contextmenu$ = (e, ...args) => {\n        contextmenu$$.call(null, e, ...args);\n        lineMark.forEach((lm) => lm.node() && lm.style('display', 'none'));\n      };\n      const zooming$$ = this.zooming$;\n      this.zooming$ = (e, ...args) => {\n        zooming$$.call(null, e, ...args);\n        const { x, x2, y, y2 } = e.scaleAxis;\n        const xScale = (x || x2).scale;\n        const yScale = (y || y2).scale;\n        drawing.call(this, zContext, { xScale, yScale });\n      };\n      const zoomend$$ = this.zoomend$;\n      this.debounceDrawend$ = util.debounce(drawend, 450, { leading: false, trailing: true });\n      this.zoomend$ = (e, ...args) => {\n        zoomend$$.call(null, e, ...args);\n        const { x, x2, y, y2 } = e.scaleAxis;\n        const xScale = (x || x2).scale;\n        const yScale = (y || y2).scale;\n        this.debounceDrawend$.call(this, zContext, { xScale, yScale });\n        if (!e.sourceEvent || e.sourceEvent.type === 'call') {\n          util.delay(() => {\n            this.debounceDrawend$.flush();\n          }, 1);\n        }\n      };\n      const resize$$ = this.resize$;\n      this.resize$ = (e, { width, height, padding, ...rest }, ...args) => {\n        resize$$.call(null, e, { width, height, padding, ...rest }, ...args);\n        zCanvasParent\n          .style('width', `${width}px`)\n          .style('height', `${height}px`)\n          .style('top', `${padding[0]}px`)\n          .style('left', `${padding[3]}px`);\n        zCanvas.attr('width', width).attr('height', height);\n        heatLabel.attr(\n          'transform',\n          `translate(${this.scale.y ? 10 : width - 10},${\n            this.scale.x ? baselineDelt - padding[0] : height + padding[2] - iconSize + baselineDelt\n          })`\n        );\n        if (legend) {\n          const heatLegend = this.rootSelection$.select('.heatLegend');\n          heatLegend.attr('transform', `translate(${width + padding[1] + legend.left},0)`);\n          heatLegend.select('rect').attr('height', height);\n          const ticks = heatLegend.selectAll('.tick');\n          const domain = ticks.data();\n          const startDomain = domain[0];\n          const deltDomain = domain[domain.length - 1] - startDomain;\n          ticks.attr('transform', (v) => `translate(${legend.width},${height * (1 - (v - startDomain) / deltDomain)})`);\n        }\n      };\n      heatLabel.on('click', () => {\n        if (this.destroyed) return;\n        this.showHeat$ = !this.showHeat$;\n        lineMark.forEach((lm) => lm.node() && lm.style('display', this.showHeat$ ? 'block' : 'none'));\n        heatLabel.attr('fill', !this.showHeat$ ? '#aaa' : 'currentColor');\n        if (this.rendered) {\n          this.render();\n        }\n      });\n    }\n\n    getPointData(e, avg) {\n      const data = this.data.heat;\n      const { point, sourceEvent, scaleAxis } = e;\n      let currentPoint = point;\n      if (!currentPoint) {\n        if (!sourceEvent) {\n          currentPoint = [0, 0];\n        } else {\n          const touches = sourceEvent.type === 'touchend' ? sourceEvent.changedTouches : sourceEvent.touches;\n          currentPoint = d3.pointer(touches ? touches[0] : sourceEvent, this.zoomSelection$.node());\n        }\n      }\n      let [x0, y0] = currentPoint;\n      const value = [];\n      if (this.showHeat$) {\n        const xScale = (scaleAxis.x || scaleAxis.x2).scale;\n        const yScale = (scaleAxis.y || scaleAxis.y2).scale;\n        let xval = xScale.invert(x0);\n        let yval = yScale.invert(y0);\n        let zval = 0;\n        const [xi0, xi1] = util.findNearIndex(+xval, data.x);\n        const [yi0, yi1] = util.findNearIndex(+yval, data.y);\n        // 确保point在图层内\n        if (xi0 >= 0 && xi1 >= 0 && yi0 >= 0 && yi1 >= 0) {\n          const xval0 = +data.x[xi0];\n          const xval1 = +data.x[xi1];\n          const yval0 = +data.y[yi0];\n          const yval1 = +data.y[yi1];\n          if (xval0 === xval1 && yval0 === yval1) {\n            // 正好移动到了xy交叉数据点上\n            zval = (data.z[yi0] || [])[xi0];\n          } else if (avg) {\n            const xInterp = computeFactor(+xval, xval0, xval1, xi0, xi1);\n            const yInterp = computeFactor(+yval, yval0, yval1, yi0, yi1);\n            const val00 = (data.z[yInterp.bin0] || [])[xInterp.bin0];\n            const val01 = (data.z[yInterp.bin0] || [])[xInterp.bin1];\n            const val10 = (data.z[yInterp.bin1] || [])[xInterp.bin0];\n            const val11 = (data.z[yInterp.bin1] || [])[xInterp.bin1];\n            zval = matrixAverage(xInterp.factor, val00, val01, yInterp.factor, val10, val11);\n          } else {\n            const xi = Math.abs(xval - xval0) > Math.abs(xval - xval1) ? xi1 : xi0;\n            const yi = Math.abs(yval - yval0) > Math.abs(yval - yval1) ? yi1 : yi0;\n            xval = +data.x[xi];\n            yval = +data.y[yi];\n            zval = (data.z[yi] || [])[xi];\n            x0 = xScale(xval);\n            y0 = yScale(yval);\n          }\n          value.push(xval, yval, zval);\n        }\n      }\n      return {\n        point: [x0, y0],\n        value,\n      };\n    }\n\n    getLineMark() {\n      const result = [];\n      const lineMarkX = this.lineMark$[0];\n      if (lineMarkX.node()) {\n        const xval = lineMarkX.datum();\n        result[0] = xval;\n      }\n      const lineMarkY = this.lineMark$[1];\n      if (lineMarkY.node()) {\n        const yval = lineMarkY.datum();\n        result[1] = yval;\n      }\n      return result;\n    }\n\n    setLineMark(lm, cb) {\n      const lineMark = lm || [];\n      const { average } = this.tooltip;\n      const heatData = this.data.heat;\n      let xSelect = null;\n      let ySelect = null;\n      const lineMarkX = this.lineMark$[0];\n      if (lineMarkX.node()) {\n        const xval = !lineMark[0] && lineMark[0] !== 0 ? heatData.x[0] : lineMark[0];\n        lineMarkX.datum(xval);\n        let zval = [];\n        // xval在数据范围之内才可计算出zval\n        if (xval >= heatData.x[0] && xval <= heatData.x[heatData.x.length - 1]) {\n          let xi = util.findNearIndex(xval, heatData.x, !average);\n          if (!average) xi = [xi, xi];\n          let xBin = 0;\n          if (xi[0] !== xi[1]) xBin = (xval - heatData.x[xi[0]]) / (heatData.x[xi[1]] - heatData.x[xi[0]]);\n          zval = heatData.z.map((v) => {\n            const vv = v || [];\n            return xBin * ((vv[xi[1]] || 0) - (vv[xi[0]] || 0)) + (vv[xi[0]] || 0);\n          });\n        }\n        xSelect = { x: xval, y: heatData.y, z: zval };\n      }\n      const lineMarkY = this.lineMark$[1];\n      if (lineMarkY.node()) {\n        const yval = !lineMark[1] && lineMark[1] !== 0 ? heatData.y[0] : lineMark[1];\n        lineMarkY.datum(yval);\n        let zval = [];\n        // yval在数据范围之内才可计算出zval\n        if (yval >= heatData.y[0] && yval <= heatData.y[heatData.y.length - 1]) {\n          let yi = util.findNearIndex(yval, heatData.y, !average);\n          if (!average) yi = [yi, yi];\n          let yBin = 0;\n          if (yi[0] !== yi[1]) yBin = (yval - heatData.y[yi[0]]) / (heatData.y[yi[1]] - heatData.y[yi[0]]);\n          zval = (heatData.z[yi[0]] || []).map((v0, i) => {\n            const v1 = (heatData.z[yi[1]] || [])[i] || 0;\n            return yBin * (v1 - v0) + v0;\n          });\n        }\n        ySelect = { x: heatData.x, y: yval, z: zval };\n      }\n      if (typeof cb === 'function') {\n        cb({ xSelect, ySelect });\n      }\n      return this;\n    }\n\n    setData(data, render, computeDomain) {\n      if (!data) return this;\n      const { heat, ...restData } = data || {};\n      super.setData(\n        {\n          heat: !heat ? { x: [], y: [], z: [] } : { x: heat.x || [], y: heat.y || [], z: heat.z || [] },\n          ...restData,\n        },\n        false,\n        !heat\n          ? computeDomain\n          : ({ heat: heatData }, needDomain) => {\n              const domains = {};\n              needDomain.forEach((key) => {\n                if (heatData[key] && heatData[key].length > 0) {\n                  domains[key] = d3.extent([...heatData[key]]);\n                }\n              });\n              return domains;\n            }\n      );\n      // 将linemark归位到起点\n      this.setLineMark();\n      if (render) {\n        this.render();\n      }\n      return this;\n    }\n\n    setDomain(domain, render) {\n      if (!domain) return this;\n      const { z, ...rest } = domain;\n      super.setDomain(rest);\n      if (z && this.scale.z) {\n        this.scale.z.domain = z;\n        updateScale.call(this);\n        if (render) {\n          this.render();\n        }\n      }\n      return this;\n    }\n\n    setLabel(label, render) {\n      if (!label) return this;\n      const { z, ...rest } = label;\n      super.setLabel(rest);\n      if (z && this.scale.z) {\n        this.scale.z.label = z.label;\n        this.scale.z.subLabel = z.subLabel;\n        this.scale.z.unit = z.unit;\n        const tempText = `${this.scale.z.label || ''}${this.scale.z.subLabel ? ` ( ${this.scale.z.subLabel} )` : ''}${\n          this.scale.z.unit ? ` ( ${this.scale.z.unit} )` : ''\n        }`;\n        this.rootSelection$\n          .select('.heatLabel')\n          .select('text')\n          .attr('dx', ((this.scale.y ? 1 : -1) * util.measureSvgText(tempText, this.fontSize)) / 2)\n          .text(tempText);\n        if (render) {\n          this.render();\n        }\n      }\n      return this;\n    }\n\n    downloadImage() {\n      const zCanvas = this.rootSelection$.select('canvas').node();\n      const svgDiv = this.rootSelection$.select('.actions');\n      const left = window.parseInt(svgDiv.style('left'));\n      const top = window.parseInt(svgDiv.style('top'));\n      super.downloadImage((this.scale.z || {}).label, {\n        image: zCanvas,\n        x: left,\n        y: top,\n      });\n    }\n\n    destroy() {\n      if (this.debounceDrawend$) {\n        this.debounceDrawend$.cancel();\n        this.debounceDrawend$ = null;\n      }\n      this.zScale$ = null;\n      this.tempCanvas$ = null;\n      this.click$ = null;\n      this.dblclick$ = null;\n      this.contextmenu$ = null;\n      this.zoomstart$ = null;\n      this.zooming$ = null;\n      this.zoomend$ = null;\n      this.resize$ = null;\n      this.reset$ = null;\n      this.canZoom$ = null;\n      super.destroy();\n      return this;\n    }\n  }\n  if (superName === 'LineGraph') {\n    mixin.replace(HeatMap, LineGraph);\n  }\n  return HeatMap;\n}\n"],"file":"generate.js"}