{"version":3,"sources":["../../src/HeatMap/generate.js"],"names":["iconSize","prefixSIFormat","d3","format","findValIndex","val","arr","n1","n2","length","c","binSize","n","test","a","b","v","Math","floor","window","console","log","min","max","computeFactor","val0","val1","bin0","bin1","factor","getInterpFactor","pixel","valPixs","index0","index1","matrixAverage","xFactor","val00","val01","yFactor","val10","val11","undefined","dx","dy","dxy","valueForPixel","value","reverse","len","minVal","maxVal","i","round","matrixInterp","w","h","d","x","y","z","x0","y0","x1","y1","cw","ch","xValPixs","yValPixs","pixels","index","Uint8Array","e","Array","xInterpArray","j","yInterp","xInterp","chasm","xbin","noChasm","findIndex","o","r","g","opacity","drawend","zContext","xScale","yScale","save","clearRect","width$","height$","showHeat$","zScale","zScale$","viewRange","data","heat","xMinPx","xMaxPx","yMinPx","yMaxPx","width","height","xcMinPx","xcMaxPx","ycMinPx","ycMaxPx","xMin","xMax","yMin","yMax","dataRange","cWidth","cHeight","pixelData","rgba","color","imageData","createImageData","set","cdata","putImageData","canvas","tempCanvas$","getContext","range","map","invert","restore","drawing","lineMarkX","lineMarkY","node","xp","datum","scale","style","yp","drawImage","tipCompute","prevRes","point","scaleAxis","scaleOpt","tooptip","cross","average","xyzValue","x2","y2","xval","yval","zval","util","findNearIndex","xi0","xi1","yi0","yi1","xval0","xval1","yval0","yval1","xi","abs","yi","push","prevValue","slice","ndata","result","selection","selectAll","join","attr","html","label","unit","updateScale","zFormat","domain","copy","clamp","colorBar","linearGradient","rootSelection$","select","heatColorBar","startDomain","deltDomain","_","enter","tick","append","text","update","doubleClick","selectX","indexOf","selectY","rate","xSelect","v0","v1","ySelect","generateHeatMap","superName","HeatMap","restOptions","restData","rWidth","show","left","isNumber","right","compute","res","args","call","tempText","subLabel","baselineDelt","fontSize","heatLabel","padding","measureSvgText","split","forEach","key","zoomSelection$","lineMark","zCanvasParent","insert","zCanvas","gradientId","guid","scaleLinear","document","createElement","dblclick$$","dblclick$","pointer","sourceEvent","contextmenu$$","contextmenu$","lm","zooming$$","zooming$","zoomend$$","zoomend$","debounceDrawend$","debounce","leading","trailing","type","delay","flush","resize$$","resize$","rest","ticks","on","destroyed","rendered","render","computeDomain","needDomain","heatData","domains","extent","svgDiv","parseInt","top","image","cancel","BaseChart","mixin","replace","LineGraph"],"mappings":"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","sourcesContent":["/*\n * @Author: Huangjs\n * @Date: 2021-12-07 15:02:48\n * @LastEditors: Huangjs\n * @LastEditTime: 2021-12-09 17:29:01\n * @Description: 按需生成HeatMap构造器\n */\n\nimport * as d3 from 'd3';\nimport BaseChart from '../BaseChart';\nimport LineGraph from '../LineGraph';\nimport * as util from '../util';\nimport mixin from '../util/mixin';\n\nconst iconSize = 18;\n\nconst prefixSIFormat = d3.format('~s');\n\nconst findValIndex = (val, arr) => {\n  let n1 = 0;\n  let n2 = arr.length;\n  let c = 0;\n  const binSize = n2 > 1 ? (arr[n2 - 1] - arr[0]) / (n2 - 1) : 1;\n  let n;\n  let test;\n  if (binSize >= 0) {\n    test = (a, b) => a <= b;\n  } else {\n    test = (a, b) => a > b;\n  }\n  // don't trust floating point equality - fraction of bin size to call\n  const v = val + binSize * 1e-9 * (binSize >= 0 ? 1 : -1);\n  // c is just to avoid infinite loops if there's an error\n  while (n1 < n2 && c < 100) {\n    c += 1;\n    n = Math.floor((n1 + n2) / 2);\n    if (test(arr[n], v)) n1 = n + 1;\n    else n2 = n;\n  }\n  if (c > 90) window.console.log('Long binary search...');\n  return Math.min(Math.max(n1 - 1, 0), arr.length - 1);\n};\n// 计算两值之间任意值占比以及前后值\nconst computeFactor = (val, val0, val1, bin0, bin1) => {\n  const factor = (val - val0) / (val1 - val0) || 0;\n  if (factor <= 0) {\n    return {\n      factor: 0,\n      bin0,\n      bin1: bin0,\n    };\n  }\n  if (factor > 0.5) {\n    return {\n      factor: 1 - factor,\n      bin0: bin1,\n      bin1: bin0,\n    };\n  }\n  return {\n    factor,\n    bin0,\n    bin1,\n  };\n};\n// 计算每个像素对应值的插值计算比例\nconst getInterpFactor = (pixel, valPixs) => {\n  const index0 = findValIndex(pixel, valPixs);\n  const index1 = index0 + 1;\n  return computeFactor(pixel, valPixs[index0], valPixs[index1], index0, index1);\n};\n// 根据四个点计算中间点的平均值\nconst matrixAverage = (xFactor, val00, val01, yFactor, val10, val11) => {\n  let val = 0;\n  if (val00 !== undefined) {\n    const dx = val01 - val00 || 0;\n    const dy = val10 - val00 || 0;\n    let dxy = 0;\n    if (val01 === undefined) {\n      if (val11 === undefined) dxy = 0;\n      else if (val10 === undefined) dxy = 2 * (val11 - val00);\n      else dxy = ((2 * val11 - val10 - val00) * 2) / 3;\n    } else if (val11 === undefined) {\n      if (val10 === undefined) dxy = 0;\n      else dxy = ((2 * val00 - val01 - val10) * 2) / 3;\n    } else if (val10 === undefined) dxy = ((2 * val11 - val01 - val00) * 2) / 3;\n    else dxy = val11 + val00 - val01 - val10;\n    val = val00 + (xFactor || 0) * dx + (yFactor || 0) * (dy + (xFactor || 0) * dxy);\n  }\n  return val;\n};\n// 将给定值数组中的值映射到给定长度的每一个像素点上\n// 若值数组长度比像素点多，则会均匀抽稀映射\n// 若值数组长度比像素点少，则会平滑插值映射\nconst valueForPixel = (value, pixel, reverse) => {\n  const valPixs = [];\n  const len = value.length;\n  const minVal = value[0];\n  const maxVal = value[len - 1];\n  for (let i = 0; i < len; i += 1) {\n    valPixs[reverse ? len - 1 - i : i] = Math.round(\n      Math.round(100 * pixel * ((value[i] - minVal) / (maxVal - minVal))) / 100\n    );\n  }\n  return valPixs;\n};\n// 矩阵插值上色（根据矩形四个点值，计算矩形内部所有像素点的值，并渲染颜色）\nconst matrixInterp = ({ w, h, d }, { x, y, z }, c) => {\n  const [[x0, y0], [x1, y1]] = d;\n  const cw = x1 - x0;\n  const ch = y1 - y0;\n  const xValPixs = valueForPixel(x, w);\n  const yValPixs = valueForPixel(y, h, true);\n  let pixels;\n  let index = 0;\n  try {\n    pixels = new Uint8Array(cw * ch * 4);\n  } catch (e) {\n    pixels = new Array(cw * ch * 4);\n  }\n  const xInterpArray = [];\n  for (let j = y0; j < y1; j += 1) {\n    const yInterp = getInterpFactor(j, yValPixs);\n    const val0 = z[yInterp.bin0];\n    const val1 = z[yInterp.bin1];\n    for (let i = x0; i < x1; i += 1) {\n      let xInterp = xInterpArray[i];\n      if (!xInterp) {\n        xInterp = getInterpFactor(i, xValPixs);\n        xInterpArray[i] = xInterp;\n      }\n      const chasm = x.chasm || [];\n      const xbin = Math.max(xInterp.bin0, xInterp.bin1);\n      const noChasm = chasm.findIndex((o) => o === xbin) === -1;\n      const { r, g, b, opacity } = noChasm\n        ? c(\n            matrixAverage(\n              xInterp.factor,\n              val0[xInterp.bin0],\n              val0[xInterp.bin1],\n              yInterp.factor,\n              val1[xInterp.bin0],\n              val1[xInterp.bin1]\n            )\n          )\n        : { r: 0, g: 0, b: 0, opacity: 0 };\n      pixels[index] = r;\n      pixels[index + 1] = g;\n      pixels[index + 2] = b;\n      pixels[index + 3] = opacity * 255; // 透明度0-1需要转换成0-255\n      index += 4;\n    }\n  }\n  return pixels;\n};\n\nfunction drawend(zContext, { xScale, yScale }) {\n  zContext.save();\n  // 先清空画布\n  zContext.clearRect(0, 0, this.width$, this.height$);\n  if (this.showHeat$) {\n    const zScale = this.zScale$;\n    let viewRange = null;\n    const { x, y, z } = this.data.heat;\n    // 原始范围\n    // 根据xy轴的刻度变换函数分别计算出原始数据图的上下左右坐标位置\n    const xMinPx = xScale(x[0] || 0);\n    const xMaxPx = xScale(x[x.length - 1] || 0);\n    // 因为y坐标是反转的（domain和range大小反转对应）\n    const yMinPx = yScale(y[y.length - 1] || 0);\n    const yMaxPx = yScale(y[0] || 0);\n    // 原始数据的实际宽高\n    const width = Math.round(xMaxPx - xMinPx);\n    const height = Math.round(yMaxPx - yMinPx);\n    // 如果实际的宽高小于或等于0则表示压根没有数据\n    if (width > 0 && height > 0) {\n      // 画布范围\n      // 画布上下左右坐标位置，this.width$, this.height$是画布的宽高\n      const xcMinPx = 0;\n      const xcMaxPx = this.width$ + xcMinPx;\n      const ycMinPx = 0;\n      const ycMaxPx = this.height$ + ycMinPx;\n      // 真实渲染的数据，是原始数据的范围，配置中筛选的范围以及画布的范围最终确定\n      // 根据以上三个范围计算确定真正需要渲染的范围，要考虑此范围的两个问题：\n      // 1，对于原始数据段转换的像素范围，应该选择哪一段像素去渲染？\n      // 2，对于视图，这一段数据应该渲染在画布上哪一个范围（在画布内部的位置）？\n      // 以下计算需要渲染的像素段在原始数据像素范围内（宽和高）起点和终点的索引\n      const xMin = Math.max(xcMinPx, xMinPx); // 取x最小范围中的最大值\n      const xMax = Math.min(xcMaxPx, xMaxPx); // 取x最大范围中的最小值\n      const yMin = Math.max(ycMinPx, yMinPx); // 取y最小范围中的最大值\n      const yMax = Math.min(ycMaxPx, yMaxPx); // 取y最大范围中的最小值\n      // 实际被裁减后的宽高（可能等于画布宽高，也可能小于，但是不会大于因为被裁掉了）\n      const dataRange = [\n        [Math.round(xMin - xMinPx), Math.round(yMin - yMinPx)], // 筛选后数据在原数据的起点index\n        [Math.round(xMax - xMinPx), Math.round(yMax - yMinPx)], // 筛选后数据在原数据的终点index\n      ];\n      const cWidth = dataRange[1][0] - dataRange[0][0];\n      const cHeight = dataRange[1][1] - dataRange[0][1];\n      // 如果裁剪后的宽高小于或等于0则表示没有可以渲染的数据了\n      if (cWidth > 0 && cHeight > 0) {\n        // 计算出渲染图片的每个像素rgba值\n        const pixelData = matrixInterp(\n          {\n            w: width,\n            h: height,\n            d: dataRange,\n          },\n          { x, y, z },\n          (v) => {\n            // 老版本d3得到的rgba是字符串，新版本d3是对象，这里做个兼容\n            const rgba = zScale(v);\n            return typeof rgba === 'string' ? d3.color(rgba) : rgba;\n          }\n        );\n        // 创建一个空的图片数据（使用裁剪后的宽高）\n        const imageData = zContext.createImageData(cWidth, cHeight);\n        // 将像素数据设置到图片数据内\n        try {\n          imageData.data.set(pixelData);\n        } catch (e) {\n          const cdata = imageData.data;\n          const len = cdata.length;\n          for (let i = 0; i < len; i += 1) {\n            cdata[i] = pixelData[i];\n          }\n        }\n        // 以下计在算在画布上需要渲染的范围起点和终点的位置（相对于画布）\n        viewRange = [\n          [xMin - xcMinPx, yMin - ycMinPx],\n          [xMax - xcMinPx, yMax - ycMinPx],\n        ];\n        // 将计算好的数据放到画布\n        zContext.putImageData(imageData, Math.round(viewRange[0][0]), Math.round(viewRange[0][1]));\n        const { canvas } = this.tempCanvas$;\n        if (canvas) {\n          // 存储渲染后的裁剪数据和图片数据\n          canvas.width = cWidth;\n          canvas.height = cHeight;\n          canvas.getContext('2d').putImageData(imageData, 0, 0);\n        }\n      }\n    }\n    this.tempCanvas$.range = !viewRange\n      ? null\n      : viewRange.map((r) => r.map((v, i) => (i === 0 ? xScale : yScale).invert(v)));\n  }\n  zContext.restore();\n}\n\nfunction drawing(zContext, { xScale, yScale }, [lineMarkX, lineMarkY]) {\n  if (this.showHeat$) {\n    if (lineMarkX.node()) {\n      const xp = xScale(lineMarkX.datum()) || (!this.scale.x ? this.width$ : 0);\n      lineMarkX.style('left', `${xp}px`).style('display', xp < 0 || xp >= this.width$ ? 'none' : 'block');\n    }\n    if (lineMarkY.node()) {\n      const yp = yScale(lineMarkY.datum()) || (!this.scale.y ? 0 : this.height$);\n      lineMarkY.style('top', `${yp}px`).style('display', yp < 0 || yp >= this.height$ ? 'none' : 'block');\n    }\n    const { canvas, range } = this.tempCanvas$;\n    if (range) {\n      // 将上一次变换后的图，经过本次变换的变形重新绘制到画布上\n      const [[x0, y0], [x1, y1]] = range.map((r) => r.map((v, i) => (i === 0 ? xScale : yScale)(v)));\n      zContext.save();\n      zContext.clearRect(0, 0, this.width$, this.height$);\n      zContext.drawImage(canvas, x0, y0, x1 - x0, y1 - y0);\n      zContext.restore();\n    }\n  }\n}\n\nfunction tipCompute(prevRes, point, scaleAxis) {\n  const data = this.data.heat;\n  const scaleOpt = this.scale;\n  const { cross, average } = this.tooptip;\n  let [x0, y0] = point;\n  const xyzValue = [];\n  if (this.showHeat$ && cross === 'xy') {\n    const xScale = (scaleAxis.x || scaleAxis.x2).scale;\n    const yScale = (scaleAxis.y || scaleAxis.y2).scale;\n    let xval = xScale.invert(x0);\n    let yval = yScale.invert(y0);\n    let zval = 0;\n    // @ts-ignore\n    const [xi0, xi1] = util.findNearIndex(+xval, data.x);\n    const [yi0, yi1] = util.findNearIndex(+yval, data.y);\n    if (xi0 >= 0 && xi1 >= 0 && yi0 >= 0 && yi1 >= 0) {\n      const xval0 = +data.x[xi0];\n      const xval1 = +data.x[xi1];\n      const yval0 = +data.y[yi0];\n      const yval1 = +data.y[yi1];\n      if (xval0 === xval1 && yval0 === yval1) {\n        // 正好移动到了xy交叉数据点上\n        zval = data.z[yi0][xi0];\n      } else if (average) {\n        const xInterp = computeFactor(+xval, xval0, xval1, xi0, xi1);\n        const yInterp = computeFactor(+yval, yval0, yval1, yi0, yi1);\n        const val00 = data.z[yInterp.bin0][xInterp.bin0];\n        const val01 = data.z[yInterp.bin0][xInterp.bin1];\n        const val10 = data.z[yInterp.bin1][xInterp.bin0];\n        const val11 = data.z[yInterp.bin1][xInterp.bin1];\n        zval = matrixAverage(xInterp.factor, val00, val01, yInterp.factor, val10, val11);\n      } else {\n        const xi = Math.abs(xval - xval0) > Math.abs(xval - xval1) ? xi1 : xi0;\n        const yi = Math.abs(yval - yval0) > Math.abs(yval - yval1) ? yi1 : yi0;\n        xval = +data.x[xi];\n        yval = +data.y[yi];\n        zval = data.z[yi][xi];\n        x0 = xScale(xval);\n        y0 = yScale(yval);\n      }\n      xyzValue.push(\n        {\n          ...scaleOpt[scaleAxis.x ? 'x' : 'x2'],\n          value: xval,\n        },\n        {\n          ...scaleOpt[scaleAxis.y ? 'y' : 'y2'],\n          value: yval,\n        },\n        {\n          ...scaleOpt.z,\n          value: zval,\n        }\n      );\n    }\n  }\n  if (xyzValue.length > 0) {\n    // 去掉第一个因为第一个是标题\n    const prevValue = (prevRes.data || []).slice(1);\n    const ndata = [...xyzValue, ...prevValue];\n    const result = (selection) => {\n      selection\n        .selectAll('div')\n        .data(ndata)\n        .join('div')\n        .attr('style', 'white-space: nowrap;')\n        .html((d, i) =>\n          i === 0\n            ? `${d.label}：${d.format(d.value)}${d.unit}`\n            : `${\n                !d.color\n                  ? ''\n                  : `<span style=\"background: ${d.color}; width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 8px;\"></span>`\n              }<span>${d.label}</span>: <span style=\"display: inline-block; ${\n                !d.color ? '' : 'margin-left: 30px;'\n              }\">${d.format(d.value)}${d.unit}</span>`\n        );\n    };\n    return { x0, y0, data: ndata, result };\n  }\n  return { ...prevRes };\n}\n\nfunction updateScale() {\n  if (this.scale.z) {\n    const zFormat = this.scale.z.format;\n    let [opacity, range, domain] = this.scale.z.domain || [];\n    opacity = opacity || 1;\n    range = range || ['#000', '#fff'];\n    domain = domain || [0, 1];\n    this.zScale$\n      .range(range.map((c) => d3.color(c).copy({ opacity })))\n      .domain(domain)\n      .clamp(true); // 设置true可以卡住所给不在domain中的参数生成的数据仍然在range范围内\n    if (this.colorBar) {\n      const linearGradient = this.rootSelection$.select('linearGradient');\n      const heatColorBar = this.rootSelection$.select('.heatColorBar');\n      const height = this.height$;\n      const startDomain = domain[0];\n      const deltDomain = domain[domain.length - 1] - startDomain;\n      const width = this.colorBar.width;\n      linearGradient\n        .selectAll('stop')\n        .data(domain)\n        .join('stop')\n        .attr('offset', (v) => `${(100 * (v - startDomain)) / deltDomain}%`)\n        .attr('stop-color', (_, i) => range[i]);\n      heatColorBar\n        .selectAll('g')\n        .data(domain)\n        .join(\n          (enter) => {\n            const tick = enter\n              .append('g')\n              .attr('class', 'tick')\n              .attr('transform', (v) => `translate(${width},${height * (1 - (v - startDomain) / deltDomain)})`);\n            tick.append('path').attr('d', 'M0,0 L4,4 L4,-4 Z');\n            tick\n              .append('text')\n              .attr('x', 8)\n              .attr('dy', '0.32em')\n              .attr('text-anchor', 'start')\n              .text((v) => zFormat(v));\n            return tick;\n          },\n          (update) => {\n            const tick = update.attr(\n              'transform',\n              (v) => `translate(${width},${height * (1 - (v - startDomain) / deltDomain)})`\n            );\n            tick.select('text').text((v) => zFormat(v));\n            return tick;\n          }\n        );\n    }\n  }\n}\n\nfunction doubleClick(point, { xScale, yScale }, [lineMarkX, lineMarkY]) {\n  const data = this.data.heat;\n  const { select, average } = this.tooptip;\n  const result = {};\n  if (this.showHeat$) {\n    const selectX = select.indexOf('x') !== -1;\n    const selectY = select.indexOf('y') !== -1;\n    let zval = [];\n    let [x0, y0] = point;\n    if (selectX) {\n      // 竖线\n      let xval = +xScale.invert(x0);\n      let xi = util.findNearIndex(xval, data.x, !average);\n      // @ts-ignore\n      if (xi.length === 2) {\n        const [xi0, xi1] = xi;\n        if (xi0 < 0) {\n          xi = xi1;\n        } else if (xi1 < 0 || xi0 === xi1) {\n          xi = xi0;\n        }\n      }\n      // @ts-ignore\n      if (xi.length === 2) {\n        const xval0 = +data.x[xi[0]];\n        const xval1 = +data.x[xi[1]];\n        const rate = (xval - xval0) / (xval1 - xval0);\n        zval = data.z.map((v) => rate * (v[xi[1]] - v[xi[0]]) + v[xi[0]]);\n      } else {\n        // @ts-ignore\n        xval = data.x[xi];\n        x0 = xScale(xval);\n        // @ts-ignore\n        zval = data.z.map((v) => v[xi]);\n      }\n      result.xSelect = { x: xval, y: data.y, z: zval };\n      if (lineMarkX.node() && x0 !== 'undefined') {\n        lineMarkX.style('left', `${x0}px`).style('display', 'block').datum(xval);\n      }\n    }\n    if (selectY) {\n      // 横线\n      let yval = +yScale.invert(y0);\n      let yi = util.findNearIndex(yval, data.y, !average);\n      // @ts-ignore\n      if (yi.length === 2) {\n        const [yi0, yi1] = yi;\n        if (yi0 < 0) {\n          yi = yi1;\n        } else if (yi1 < 0 || yi0 === yi1) {\n          yi = yi0;\n        }\n      }\n      // @ts-ignore\n      if (yi.length === 2) {\n        const yval0 = +data.y[yi[0]];\n        const yval1 = +data.y[yi[1]];\n        const rate = (yval - yval0) / (yval1 - yval0);\n        zval = data.z[yi[0]].map((v0, i) => {\n          const v1 = data.z[yi[1]][i];\n          return rate * (v1 - v0) + v0;\n        });\n      } else {\n        // @ts-ignore\n        yval = data.y[yi];\n        y0 = yScale(yval);\n        // @ts-ignore\n        zval = data.z[yi] || [];\n      }\n      result.ySelect = { x: data.x, y: yval, z: zval };\n      if (lineMarkY.node() && y0 !== 'undefined') {\n        lineMarkY.style('top', `${y0}px`).style('display', 'block').datum(yval);\n      }\n    }\n  }\n  return result;\n}\n\nexport default function generateHeatMap(superName) {\n  class HeatMap extends BaseChart {\n    constructor(...params) {\n      const { data, tooptip, colorBar, scale, ...restOptions } = params[0] || {};\n      const { heat, ...restData } = data || {};\n      let rWidth = restOptions.rWidth;\n      if (colorBar) {\n        colorBar.show = !!colorBar.show;\n        colorBar.left = util.isNumber(colorBar.left) ? colorBar.left : 0;\n        colorBar.width = util.isNumber(colorBar.width) ? colorBar.width : 0;\n        colorBar.right = util.isNumber(colorBar.right) ? colorBar.right : 0;\n        if (colorBar.show) {\n          rWidth = (util.isNumber(rWidth) ? rWidth : 0) + colorBar.left + colorBar.width + colorBar.right;\n        }\n      }\n      super({\n        ...restOptions,\n        rWidth,\n        data: {\n          heat: !heat ? { x: [], y: [], z: [] } : { x: heat.x || [], y: heat.y || [], z: heat.z || [] },\n          ...restData,\n        },\n        tooptip: !tooptip\n          ? false\n          : {\n              cross: 'xy',\n              select: '',\n              average: true,\n              ...tooptip,\n              compute: (res, ...args) => {\n                let result = tipCompute.call(this, res, ...args);\n                if (typeof tooptip.compute === 'function') {\n                  result = tooptip.compute.call(this, result, ...args);\n                }\n                return result;\n              },\n            },\n        scale: {\n          /* z: {\n            type: 'linear', // 坐标类型\n            ticks: 5, // 坐标刻度数目\n            format: (v) => v, // 坐标值格式化函数\n            domain: [0, ['#fff', '#fff'], [0, 0]], // 值的色域范围和透明度\n            label: '', // 坐标名称\n            unit: '', // 坐标值单位\n          }, */\n          z: { format: prefixSIFormat },\n          ...scale,\n        },\n      });\n      this.colorBar = colorBar;\n      this.showHeat$ = true;\n      const tempText = `${this.scale.z.label || ''}${this.scale.z.subLabel ? ` ( ${this.scale.z.subLabel} )` : ''}${\n        this.scale.z.unit ? ` ( ${this.scale.z.unit} )` : ''\n      }`;\n      // @ts-ignore\n      const baselineDelt = this.fontSize + 2;\n      const heatLabel = this.rootSelection$\n        .select('g.group')\n        .append('g')\n        .attr('class', 'heatLabel')\n        .attr('fill', 'currentColor')\n        .attr(\n          'transform',\n          // @ts-ignore\n          `translate(${this.scale.y ? 10 : this.width$ - 10},${\n            // @ts-ignore\n            this.scale.x ? baselineDelt - this.padding[0] : this.height$ + this.padding[2] - iconSize + baselineDelt\n          })`\n        );\n      heatLabel\n        .append('text')\n        .attr('dx', ((this.scale.y ? 1 : -1) * util.measureSvgText(tempText, this.fontSize)) / 2)\n        .text(tempText);\n      if (this.tooptip) {\n        const { select } = this.tooptip;\n        select.split('').forEach((key) => {\n          if (key) {\n            // @ts-ignore\n            this.zoomSelection$\n              .append('div')\n              .attr('class', `${key}-linemark`)\n              .style('background', '#fa9305')\n              .style('display', 'none')\n              .style('position', 'absolute')\n              // @ts-ignore\n              .style('top', !this.scale.y ? 0 : this.height$ - 1)\n              // @ts-ignore\n              .style('left', !this.scale.x ? this.width$ - 1 : 0)\n              .style('width', key === 'x' ? '1px' : '100%')\n              .style('height', key === 'x' ? '100%' : '1px');\n          }\n        });\n      }\n      // @ts-ignore\n      const lineMark = [this.zoomSelection$.select('.x-linemark'), this.zoomSelection$.select('.y-linemark')];\n      const zCanvasParent = this.rootSelection$\n        .insert('div', 'svg')\n        .style('position', 'absolute')\n        // @ts-ignore\n        .style('width', `${this.width$}px`)\n        // @ts-ignore\n        .style('height', `${this.height$}px`)\n        // @ts-ignore\n        .style('top', `${this.padding[0]}px`)\n        // @ts-ignore\n        .style('left', `${this.padding[3]}px`);\n      const zCanvas = zCanvasParent\n        .append('canvas')\n        .style('width', '100%')\n        .style('height', '100%')\n        // @ts-ignore\n        .attr('width', this.width$)\n        // @ts-ignore\n        .attr('height', this.height$);\n      if (colorBar) {\n        const gradientId = util.guid('gradient');\n        this.rootSelection$\n          .select('svg')\n          .select('defs')\n          .append('linearGradient')\n          .attr('id', gradientId)\n          .attr('x1', '0%')\n          .attr('y1', '100%')\n          .attr('x2', '0%')\n          .attr('y2', '0%');\n        this.rootSelection$\n          .select('svg')\n          .select('.group')\n          .append('g')\n          .attr('class', 'heatColorBar')\n          .style('display', colorBar.show ? 'block' : 'none')\n          .attr('fill', 'currentColor')\n          // @ts-ignore\n          .attr('transform', `translate(${this.width$ + this.padding[1] + colorBar.left},0)`)\n          .append('rect')\n          .attr('x', 0)\n          .attr('y', 0)\n          .attr('width', colorBar.width)\n          // @ts-ignore\n          .attr('height', this.height$)\n          .attr('fill', `url(#${gradientId})`);\n      }\n      const zContext = zCanvas.node().getContext('2d');\n      this.zScale$ = d3.scaleLinear();\n      updateScale.call(this);\n      this.tempCanvas$ = {\n        canvas: document.createElement('canvas'),\n        range: null,\n      };\n      const dblclick$$ = this.dblclick$;\n      this.dblclick$ = (e, ...args) => {\n        dblclick$$.call(null, e, ...args);\n        const { x, x2, y, y2 } = e.scaleAxis;\n        const xScale = (x || x2).scale;\n        const yScale = (y || y2).scale;\n        return doubleClick.call(this, d3.pointer(e.sourceEvent), { xScale, yScale }, lineMark);\n      };\n      const contextmenu$$ = this.contextmenu$;\n      this.contextmenu$ = (e, ...args) => {\n        contextmenu$$.call(null, e, ...args);\n        lineMark.forEach((lm) => lm.node() && lm.style('display', 'none'));\n      };\n      const zooming$$ = this.zooming$;\n      this.zooming$ = (e, ...args) => {\n        zooming$$.call(null, e, ...args);\n        const { x, x2, y, y2 } = e.scaleAxis;\n        const xScale = (x || x2).scale;\n        const yScale = (y || y2).scale;\n        drawing.call(this, zContext, { xScale, yScale }, lineMark);\n      };\n      const zoomend$$ = this.zoomend$;\n      this.debounceDrawend$ = util.debounce(drawend, 450, { leading: false, trailing: true });\n      this.zoomend$ = (e, ...args) => {\n        zoomend$$.call(null, e, ...args);\n        const { x, x2, y, y2 } = e.scaleAxis;\n        const xScale = (x || x2).scale;\n        const yScale = (y || y2).scale;\n        this.debounceDrawend$.call(this, zContext, { xScale, yScale });\n        if (e.sourceEvent.type === 'call') {\n          util.delay(() => {\n            this.debounceDrawend$.flush();\n          }, 1);\n        }\n      };\n      const resize$$ = this.resize$;\n      this.resize$ = (e, { width, height, padding, ...rest }, ...args) => {\n        resize$$.call(null, e, { width, height, padding, ...rest }, ...args);\n        zCanvasParent\n          .style('width', `${width}px`)\n          .style('height', `${height}px`)\n          .style('top', `${padding[0]}px`)\n          .style('left', `${padding[3]}px`);\n        zCanvas.attr('width', width).attr('height', height);\n        heatLabel.attr(\n          'transform',\n          `translate(${this.scale.y ? 10 : width - 10},${\n            this.scale.x ? baselineDelt - padding[0] : height + padding[2] - iconSize + baselineDelt\n          })`\n        );\n        if (colorBar) {\n          const heatColorBar = this.rootSelection$.select('.heatColorBar');\n          heatColorBar.attr('transform', `translate(${width + padding[1] + colorBar.left},0)`);\n          heatColorBar.select('rect').attr('height', height);\n          const ticks = heatColorBar.selectAll('.tick');\n          const domain = ticks.data();\n          const startDomain = domain[0];\n          const deltDomain = domain[domain.length - 1] - startDomain;\n          ticks.attr(\n            'transform',\n            (v) => `translate(${colorBar.width},${height * (1 - (v - startDomain) / deltDomain)})`\n          );\n        }\n      };\n      heatLabel.on('click', () => {\n        if (this.destroyed) return;\n        this.showHeat$ = !this.showHeat$;\n        lineMark.forEach((lm) => lm.node() && lm.style('display', this.showHeat$ ? 'block' : 'none'));\n        heatLabel.attr('fill', !this.showHeat$ ? '#aaaa' : 'currentColor');\n        if (this.rendered) {\n          this.render();\n        }\n      });\n    }\n\n    setData(data, render, computeDomain) {\n      if (!data) return this;\n      const { heat, ...restData } = data || {};\n      super.setData(\n        {\n          heat: !heat ? { x: [], y: [], z: [] } : { x: heat.x || [], y: heat.y || [], z: heat.z || [] },\n          ...restData,\n        },\n        false,\n        !heat\n          ? computeDomain\n          : ({ heat: heatData }, needDomain) => {\n              const domains = {};\n              needDomain.forEach((key) => {\n                if (heatData[key] && heatData[key].length > 0) {\n                  domains[key] = d3.extent([...heatData[key]]);\n                }\n              });\n              return domains;\n            }\n      );\n      // @ts-ignore\n      const lineMarkX = this.zoomSelection$.select('.x-linemark');\n      // @ts-ignore\n      const lineMarkY = this.zoomSelection$.select('.y-linemark');\n      if (lineMarkX.node()) {\n        lineMarkX.datum(this.data.heat.x[0]);\n      }\n      if (lineMarkY.node()) {\n        lineMarkY.datum(this.data.heat.y[0]);\n      }\n      if (render) {\n        this.render();\n      }\n      return this;\n    }\n\n    setDomain(domain, render) {\n      if (!domain) return this;\n      const { z, ...rest } = domain;\n      super.setDomain(rest);\n      if (z && this.scale.z) {\n        this.scale.z.domain = z;\n        updateScale.call(this);\n        if (render) {\n          this.render();\n        }\n      }\n      return this;\n    }\n\n    setLabel(label, render) {\n      if (!label) return this;\n      const { z, ...rest } = label;\n      super.setLabel(rest);\n      if (z && this.scale.z) {\n        this.scale.z.label = z.label;\n        this.scale.z.subLabel = z.subLabel;\n        this.scale.z.unit = z.unit;\n        const tempText = `${this.scale.z.label || ''}${this.scale.z.subLabel ? ` ( ${this.scale.z.subLabel} )` : ''}${\n          this.scale.z.unit ? ` ( ${this.scale.z.unit} )` : ''\n        }`;\n        this.rootSelection$\n          .select('.heatLabel')\n          .select('text')\n          .attr('dx', ((this.scale.y ? 1 : -1) * util.measureSvgText(tempText, this.fontSize)) / 2)\n          .text(tempText);\n        if (render) {\n          this.render();\n        }\n      }\n      return this;\n    }\n\n    downloadImage() {\n      const zCanvas = this.rootSelection$.select('canvas').node();\n      const svgDiv = this.rootSelection$.select('.actions');\n      const left = window.parseInt(svgDiv.style('left'));\n      const top = window.parseInt(svgDiv.style('top'));\n      super.downloadImage((this.scale.z || {}).label, {\n        image: zCanvas,\n        x: left,\n        y: top,\n      });\n    }\n\n    destroy() {\n      if (this.debounceDrawend$) {\n        this.debounceDrawend$.cancel();\n        this.debounceDrawend$ = null;\n      }\n      if (this.zScale$) this.zScale$ = null;\n      // @ts-ignore\n      if (this.tempCanvas$) this.tempCanvas$ = {};\n      super.destroy();\n      return this;\n    }\n  }\n  if (superName === 'LineGraph') {\n    mixin.replace(HeatMap, LineGraph);\n  }\n  return HeatMap;\n}\n"],"file":"generate.js"}