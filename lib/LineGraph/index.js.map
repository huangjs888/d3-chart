{"version":3,"sources":["../../src/LineGraph/index.js"],"names":["lineLabel","onlyOneMerge","tooptip","pWidth","color","v","c","filter$","findIndex","f","key","width","util","measureSvgText","label","fontSize","tWidth","zlabel","rootSelection$","select","selectAll","remove","data","line","join","enter","legend","append","attr","moveX","w","scale","y","width$","insert","smooth","text","update","exit","showData","differenceWith","a","b","d","tipCompute","prevRes","point","scaleAxis","ok","scaleOpt","cross","average","crossX","indexOf","crossY","xScale","x","x2Scale","x2","yScale","y2Scale","y2","x0","y0","xyValue","fData","forEach","xxKey","xxScale","length","Error","yyKey","xval","invert","yval","findNearIndex","map","xi0","xi1","xval0","xval1","valRate","xi","Math","abs","value","push","yyScale","yi0","yi1","yval0","yval1","yi","prevValue","slice","result","selection","html","i","format","unit","updateLine","curve","d3","curveLinear","curveBasis","curveBundle","beta","line$","LineGraph","restOptions","restData","xy","restLine","compute","res","args","call","zooming$$","zooming$","e","on","destroyed","datum","target","index","splice","rendered","render","computeDomain","needDomain","lineData","domains","rd","dc","Object","keys","k","extent","BaseChart"],"mappings":"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","sourcesContent":["/*\n * @Author: Huangjs\n * @Date: 2021-03-17 16:23:00\n * @LastEditors: Huangjs\n * @LastEditTime: 2021-12-30 12:01:59\n * @Description: 默认LineGraph构造器\n */\n\nimport * as d3 from 'd3';\nimport BaseChart from '../BaseChart';\nimport * as util from '../util';\n\nfunction lineLabel() {\n  const { onlyOneMerge } = this.tooptip;\n  const pWidth = onlyOneMerge ? 0 : 20;\n  const color = (v, c) => (this.filter$.findIndex((f) => f.key === v.key) !== -1 ? '#aaa' : c);\n  const width = (v) => util.measureSvgText(v.label, this.fontSize) + pWidth;\n  let tWidth = 0;\n  const zlabel = this.rootSelection$.select('.zLabel');\n  zlabel.selectAll('g').remove();\n  zlabel\n    .selectAll('g')\n    .data(this.data.line)\n    .join(\n      (enter) => {\n        const legend = enter\n          .append('g')\n          .attr('class', 'line-legend')\n          .attr('transform', (v) => {\n            let moveX = 0;\n            const w = width(v) + 5;\n            if (onlyOneMerge) {\n              moveX = this.scale.y ? -((this.width$ + w) / 2) : (this.width$ - w) / 2;\n            } else {\n              moveX = this.scale.y ? 5 - tWidth - w : tWidth;\n              tWidth += w;\n            }\n            return `translate(${moveX},0)`;\n          });\n        if (!onlyOneMerge) {\n          legend\n            .insert('path')\n            .attr('fill', 'none')\n            .attr('stroke-width', 4)\n            .attr('transform', `translate(0,${-this.fontSize / 2}),scale(0.5)`)\n            .attr('d', this.smooth === 1 ? 'M0 6 C4 0,8 0,12 6 S20 12,24 6' : 'M0 6,28 6')\n            .attr('stroke', (v) => color(v, v.color || 'inherit'));\n        }\n        legend\n          .insert('text')\n          .attr('dx', pWidth)\n          .attr('text-anchor', 'start')\n          .attr('stroke-width', 0.5)\n          .text((v) => v.label)\n          .attr('fill', (v) => color(v, 'currentColor'));\n        return legend;\n      },\n      (update) => update,\n      (exit) => exit.remove()\n    );\n\n  const showData = util.differenceWith(this.data.line, this.filter$, (a, b) => a.key === b.key);\n  this.rootSelection$\n    .select('.zAxis')\n    .selectAll('path')\n    .data(showData)\n    .join('path')\n    .attr('stroke', (d) => d.color || 'inherit')\n    .attr('stroke-width', 1.2);\n}\n\nfunction tipCompute(prevRes, point, scaleAxis) {\n  const ok = (a) => a === 0 || !!a;\n  const scaleOpt = this.scale;\n  const { cross, average, onlyOneMerge } = this.tooptip;\n  const crossX = cross.indexOf('x') !== -1;\n  const crossY = cross.indexOf('y') !== -1;\n  const xScale = scaleAxis.x && scaleAxis.x.scale;\n  const x2Scale = scaleAxis.x2 && scaleAxis.x2.scale;\n  const yScale = scaleAxis.y && scaleAxis.y.scale;\n  const y2Scale = scaleAxis.y2 && scaleAxis.y2.scale;\n  let [x0, y0] = point;\n  const xyValue = [];\n  const fData = util.differenceWith(this.data.line, this.filter$, (a, b) => a.key === b.key);\n  if (crossX) {\n    fData.forEach(({ data, color, label }) => {\n      let xxKey = 'x';\n      let xxScale = xScale;\n      if (x2Scale && data.length > 0) {\n        if (ok(data[0].x2)) {\n          xxKey = 'x2';\n          xxScale = x2Scale;\n        } else if (!xScale) {\n          throw new Error('scale只配置了x2坐标，但数据中没有x2值');\n        }\n      }\n      let yyKey = 'y';\n      if (y2Scale && data.length > 0) {\n        if (ok(data[0].y2)) {\n          yyKey = 'y2';\n        } else if (!yScale) {\n          throw new Error('scale只配置了y2坐标，但数据中没有y2值');\n        }\n      }\n      let xval = xxScale.invert(x0);\n      let yval = null;\n      // @ts-ignore\n      const [xi0, xi1] = util.findNearIndex(\n        +xval,\n        data.map((d) => d[xxKey])\n      );\n      if (xi0 >= 0 && xi1 >= 0) {\n        const xval0 = !data[xi0] ? 0 : data[xi0][xxKey];\n        const xval1 = !data[xi1] ? 0 : data[xi1][xxKey];\n        if (xval0 === xval1) {\n          // 正好移动到了数据点上\n          yval = !data[xi0] ? 0 : data[xi0][yyKey];\n        } else if (average) {\n          // 平均值显示\n          const valRate = (xval - xval0) / (xval1 - xval0);\n          yval =\n            valRate * ((!data[xi1] ? 0 : data[xi1][yyKey]) - (!data[xi0] ? 0 : data[xi0][yyKey])) +\n            (!data[xi0] ? 0 : data[xi0][yyKey]);\n        } else {\n          // 最近值显示\n          const xi = Math.abs(xval - xval0) > Math.abs(xval - xval1) ? xi1 : xi0;\n          xval = !data[xi] ? 0 : data[xi][xxKey];\n          yval = !data[xi] ? 0 : data[xi][yyKey];\n          x0 = xxScale(xval);\n        }\n        xyValue[0] = { ...scaleOpt[xxKey], value: xval };\n        xyValue.push({\n          ...scaleOpt[yyKey],\n          value: yval,\n          color,\n          ...(onlyOneMerge ? {} : { label }),\n        });\n      }\n    });\n  } else if (crossY) {\n    fData.forEach(({ data, color, label }) => {\n      let yyKey = 'y';\n      let yyScale = yScale;\n      if (y2Scale && data.length > 0) {\n        if (ok(data[0].y2)) {\n          yyKey = 'y2';\n          yyScale = y2Scale;\n        } else if (!yScale) {\n          throw new Error('scale只配置了y2坐标，但数据中没有y2值');\n        }\n      }\n      let xxKey = 'x';\n      if (x2Scale && data.length > 0) {\n        if (ok(data[0].x2)) {\n          xxKey = 'x2';\n        } else if (!xScale) {\n          throw new Error('scale只配置了x2坐标，但数据中没有x2值');\n        }\n      }\n      let yval = yyScale.invert(y0);\n      let xval = null;\n      const [yi0, yi1] = util.findNearIndex(\n        +yval,\n        data.map((d) => d[yyKey])\n      );\n      if (yi0 >= 0 && yi1 >= 0) {\n        const yval0 = !data[yi0] ? 0 : data[yi0][yyKey];\n        const yval1 = !data[yi1] ? 0 : data[yi1][yyKey];\n        if (yval0 === yval1) {\n          // 正好移动到了数据点上\n          xval = !data[yi0] ? 0 : data[yi0][xxKey];\n        } else if (average) {\n          // 平均值显示\n          const valRate = (yval - yval0) / (yval1 - yval0);\n          xval =\n            valRate * ((!data[yi1] ? 0 : data[yi1][xxKey]) - (!data[yi0] ? 0 : data[yi0][xxKey])) +\n            (!data[yi0] ? 0 : data[yi0][xxKey]);\n        } else {\n          // 最近值显示\n          const yi = Math.abs(yval - yval0) > Math.abs(yval - yval1) ? yi1 : yi0;\n          yval = !data[yi] ? 0 : data[yi][yyKey];\n          xval = !data[yi] ? 0 : data[yi][xxKey];\n          y0 = yyScale(yval);\n        }\n        xyValue[0] = { ...scaleOpt[yyKey], value: yval };\n        xyValue.push({\n          ...scaleOpt[xxKey],\n          value: xval,\n          color,\n          ...(onlyOneMerge ? {} : { label }),\n        });\n      }\n    });\n  }\n  if (xyValue.length > 0) {\n    // 去掉第一个因为第一个是标题\n    const prevValue = (prevRes.data || []).slice(1);\n    const data = [...xyValue, ...prevValue];\n    const result = (selection) => {\n      selection\n        .selectAll('div')\n        .data(data)\n        .join('div')\n        .attr('style', 'white-space: nowrap;')\n        .html((d, i) =>\n          i === 0\n            ? `${d.label}：${d.format(d.value)}${d.unit}`\n            : `${\n                onlyOneMerge || !d.color\n                  ? ''\n                  : `<span style=\"background: ${d.color}; width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 8px;\"></span>`\n              }<span>${d.label}</span>: <span style=\"display: inline-block; ${\n                onlyOneMerge || !d.color ? '' : 'margin-left: 30px;'\n              }\">${d.format(d.value)}${d.unit}</span>`\n        );\n    };\n    return { x0, y0, data, result };\n  }\n  return { ...prevRes };\n}\n\nfunction updateLine() {\n  let curve = d3.curveLinear; // 折线\n  if (this.smooth >= 1) {\n    curve = d3.curveBasis; // 平滑曲线\n  } else if (this.smooth < 1 && this.smooth > 0) {\n    // @ts-ignore\n    curve = d3.curveBundle.beta(this.smooth); // 平滑度为0.8曲线\n  }\n  this.line$.curve(curve);\n}\n\nclass LineGraph extends BaseChart {\n  constructor(...params) {\n    const { smooth, data, tooptip, ...restOptions } = params[0] || {};\n    const { line, ...restData } = data || {};\n    super({\n      ...restOptions,\n      data: {\n        line: (line || []).map(({ data: xy, ...restLine }) => ({\n          data: xy || [],\n          ...restLine,\n        })),\n        ...restData,\n      },\n      tooptip: !tooptip\n        ? false\n        : {\n            cross: 'x',\n            ...tooptip,\n            compute: (res, ...args) => {\n              let result = tipCompute.call(this, res, ...args);\n              if (typeof tooptip.compute === 'function') {\n                result = tooptip.compute.call(this, result, ...args);\n              }\n              return result;\n            },\n          },\n    });\n    this.smooth = smooth || 0;\n    this.line$ = d3.line();\n    updateLine.call(this);\n    this.filter$ = [];\n    const zooming$$ = this.zooming$;\n    this.zooming$ = (e, ...args) => {\n      zooming$$.call(null, e, ...args);\n      const { scaleAxis } = e;\n      const xScale = (scaleAxis.x || scaleAxis.x2).scale;\n      const x2Scale = (scaleAxis.x2 || scaleAxis.x).scale;\n      const yScale = (scaleAxis.y || scaleAxis.y2).scale;\n      const y2Scale = (scaleAxis.y2 || scaleAxis.y).scale;\n      this.rootSelection$\n        .select('.zAxis')\n        // .selectChildren() // ie11及以下不支持SVGSVGElement.children（其实可以SVGSVGElement.childNodes，但是d3未做兼容）\n        .selectAll('path')\n        .attr('d', (d) =>\n          this.line$\n            // @ts-ignore\n            .x(({ x, x2 }) => (typeof x === 'undefined' ? x2Scale(x2 || 0) : xScale(x || 0)))\n            // @ts-ignore\n            .y(({ y, y2 }) => (typeof y === 'undefined' ? y2Scale(y2 || 0) : yScale(y || 0)))(d.data)\n        );\n    };\n    this.rootSelection$.select('.zLabel').on('click', (e) => {\n      if (this.destroyed) return;\n      const datum = d3.select(e.target).datum();\n      const index = this.filter$.findIndex((f) => f.key === datum.key);\n      if (index === -1) {\n        this.filter$.push(datum);\n      } else {\n        this.filter$.splice(index, 1);\n      }\n      lineLabel.call(this);\n      if (this.rendered) {\n        this.render();\n      }\n    });\n    lineLabel.call(this);\n  }\n\n  setData(data, render, computeDomain) {\n    if (!data) return this;\n    const { line, ...restData } = data;\n    super.setData(\n      {\n        line: (line || []).map(({ data: xy, ...restLine }) => ({\n          data: xy || [],\n          ...restLine,\n        })),\n        ...restData,\n      },\n      false,\n      !line\n        ? computeDomain\n        : ({ line: lineData }, needDomain) => {\n            const domains = {};\n            lineData.forEach((rd) => {\n              const xy = {};\n              rd.data.forEach((dc) => {\n                Object.keys(dc).forEach((k) => {\n                  if (!xy[k]) xy[k] = [];\n                  xy[k].push(dc[k]);\n                });\n              });\n              needDomain.forEach((key) => {\n                if (xy[key] && xy[key].length > 0) {\n                  domains[key] = d3.extent([...xy[key], ...(domains[key] || [])]);\n                }\n              });\n            });\n            return domains;\n          }\n    );\n    if (this.data.line.length !== 1) {\n      this.tooptip.onlyOneMerge = false;\n    }\n    lineLabel.call(this);\n    if (render) {\n      this.render();\n    }\n    return this;\n  }\n\n  setSmooth(smooth, render) {\n    this.smooth = smooth;\n    this.rendered = false;\n    updateLine.call(this);\n    if (render) {\n      this.render();\n    }\n    return this;\n  }\n\n  destroy() {\n    if (this.line$) this.line$ = null;\n    if (this.filter$) this.filter$ = [];\n    super.destroy();\n    return this;\n  }\n}\n\nexport default LineGraph;\n"],"file":"index.js"}